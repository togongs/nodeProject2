<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
    crossorigin="anonymous"
    />
    
    <title>전체 게시판</title>
  </head>

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
    integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.4.0/socket.io.js"></script>

  <script>
    // 2. 다시 볼것
      $(document).ready(function () {
        // 토큰이 있는 경우 로그인 기능 hide
        if(localStorage.getItem('token')) {
          $('#btn_login').hide()
          $('#btn_logout').show()
      } else {
        // 토큰이 없는 경우 게시글 작성 hide
        $('#btn_logout').hide()
        $('#btn_post').hide()
      }

      get_write()
    })

        // 3. 다시 볼것
      function get_write(category) {
          $("#write").empty()
          console.log(category)
          $.ajax({
              type: "GET",
              url: `/main/data`,
              data: {},
              success: function (response) {
                  let write = response["data"]
                  for (let i = 0; i < write.length; i++) {
                      make_card(write[i])
                  }
              }
          })
      }
      // ? 뒤에부터 쿼리문.. objectId값을 사용한다
      function make_card(item) {
        let htmlTemp = `<tr>
                            <th><a href="/detail?writeId=${item['_id']}">${item["title"]}</a></th>
                            <th>${item["name"]}</th>
                            <th>${item["content"]}</th>
                            <th>${item["date"]}</th>
                        </tr>`
                        $("#write").append(htmlTemp);
      }

    function sign_out() { 
      localStorage.clear(); 
      alert("로그아웃 했습니다"); 
      window.location.reload()
    }

  </script>

  <body>
    <p>
      <img src="/static/mylogo.jpeg" width="40px">나만의 게시판<hr>
    </p>
    
    <div>
      <div class="wrap">
        <div>
            <table class="table">
                <thead>
                    <tr>
                        <th>제목</th>
                        <th>작성자</th>
                        <th>내용</th>
                        <th>날짜</th>
                    </tr>
                </thead>
                <tbody id="write">
                  
                </tbody>
            </table>
        </div>
        <button id="btn_post" onclick="window.location.href='/write'">게시글 작성</button>
        <button id="btn_login" onclick="window.location.href='/login'">로그인</button>
        <button id="btn_logout" onclick="sign_out()">로그아웃</button>
  </body>
</html>